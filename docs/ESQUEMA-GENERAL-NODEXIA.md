# Esquema General Nodexia - Mapa Operativo Completo

> Ãšltima actualizaciÃ³n: 10 de Febrero 2026

---

## Flujo Operativo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 1: CREACIÃ“N Y ASIGNACIÃ“N                        â”‚
â”‚                                                                         â”‚
â”‚  ğŸ­ Planta crea Despacho â”€â”€â–º AsignaciÃ³n â”€â”€â”¬â”€â”€ Directa â†’ Transporte     â”‚
â”‚                                           â””â”€â”€ Red â†’ Transportista aceptaâ”‚
â”‚                               â”‚                                         â”‚
â”‚                    ğŸ‘¤ Coordinador asigna Chofer + CamiÃ³n                 â”‚
â”‚                               â”‚                                         â”‚
â”‚                    âœ… Chofer confirma viaje                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 2: TRÃNSITO A ORIGEN                            â”‚
â”‚                                                                         â”‚
â”‚  ğŸš— Chofer inicia viaje â”€â”€[GPS Tracking]â”€â”€â–º ğŸ“ Chofer arriba a origen   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 3: PLANTA ORIGEN                                â”‚
â”‚                                                                         â”‚
â”‚  ğŸš§ CA ingreso â†’ ğŸ…¿ï¸ Playa â†’ ğŸ“¢ Llamado â†’ â¬†ï¸ Cargando â†’ ğŸ“¦ Cargado    â”‚
â”‚                                                   â”‚                     â”‚
â”‚                              ğŸ“¸ Supervisor sube foto remito             â”‚
â”‚                              âœ… CA valida remito                        â”‚
â”‚                              ğŸšª CA registra egreso origen               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 4: TRÃNSITO A DESTINO                           â”‚
â”‚                                                                         â”‚
â”‚  ğŸšš Chofer inicia viaje â”€â”€[GPS Tracking]â”€â”€â–º ğŸ“ Chofer arriba a destino  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 5: PLANTA DESTINO                               â”‚
â”‚                                                                         â”‚
â”‚  Â¿Destino usa Nodexia?                                                  â”‚
â”‚     SÃ â†’ ğŸš§ CA ingreso â†’ ğŸ“¢ Llamado â†’ â¬‡ï¸ Descargando â†’ âœ… Descargado  â”‚
â”‚          â†’ ğŸšª CA egreso destino                                         â”‚
â”‚     NO â†’ ğŸ Chofer finaliza directo                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASE 6: FINALIZACIÃ“N                                 â”‚
â”‚                                                                         â”‚
â”‚  ğŸš› VacÃ­o â†’ ğŸ“Š Viaje completado â†’ ğŸ“ˆ MÃ©tricas y reportes               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cadena de Estados del Viaje

```
camion_asignado â†’ confirmado_chofer â†’ en_transito_origen â†’ arribo_origen
â†’ ingresado_origen â†’ en_playa_origen â†’ llamado_carga â†’ cargando â†’ cargado
â†’ egreso_origen â†’ en_transito_destino â†’ arribado_destino
â†’ [CON NODEXIA] ingresado_destino â†’ llamado_descarga â†’ descargando â†’ descargado â†’ egreso_destino
â†’ [SIN NODEXIA] (directo)
â†’ vacio â†’ viaje_completado
```

---

## Roles y Vistas del Sistema

### ğŸ­ PLANTA (Empresa productora/origen/destino)
| Vista | FunciÃ³n | Estado |
|---|---|---|
| Crear Despachos | Crear y gestionar despachos, ver estado | âœ… Funciona |
| Supervisor Carga | Llamar a carga, monitorear, subir remito | âœ… Funciona |
| Control Acceso | Escanear QR, ingreso/egreso, validar remito | âœ… Funciona |
| EstadÃ­sticas | MÃ©tricas operativas | âš ï¸ BÃ¡sico |

### ğŸš› TRANSPORTE (Empresa transportista)
| Vista | FunciÃ³n | Estado |
|---|---|---|
| Dashboard Transporte | Resumen operativo | âœ… Funciona |
| Viajes Activos | Mapa tiempo real, estados, tracking | âœ… Funciona |
| Despachos Ofrecidos | Cargas publicadas en red | âš ï¸ Parcial |
| Flota | GestiÃ³n camiones y choferes | âœ… Funciona |
| Tracking GPS | VisualizaciÃ³n GPS de flota | âš ï¸ Parcial |
| ConfiguraciÃ³n | Ajustes de empresa | âœ… Funciona |

### ğŸ‘¤ CHOFER (Web App MÃ³vil)
| Vista | FunciÃ³n | Estado |
|---|---|---|
| Mis Viajes | Lista de viajes asignados, acciones | âœ… Funciona |
| GPS Tracking | EnvÃ­o automÃ¡tico de posiciÃ³n | âš ï¸ Parcial |
| Acciones de estado | Confirmar, iniciar, arribar, finalizar | âœ… Funciona |
| Incidencias | Reportar problemas en ruta | âŒ Sin implementar |

### ğŸ‘‘ SUPER ADMIN
| Vista | FunciÃ³n | Estado |
|---|---|---|
| GestiÃ³n Empresas | CRUD empresas, configuraciÃ³n | âœ… Funciona |
| GestiÃ³n Usuarios | CRUD usuarios, roles, permisos | âœ… Funciona |
| Config Global | ParÃ¡metros del sistema | âš ï¸ BÃ¡sico |

---

## Estado por Fase - Detalle de ImplementaciÃ³n

### FASE 1: CreaciÃ³n y AsignaciÃ³n
| Funcionalidad | Estado | Notas |
|---|---|---|
| Planta crea despacho | âœ… Funciona | Formulario completo |
| AsignaciÃ³n directa a transporte | âœ… Funciona | SelecciÃ³n de transportista |
| PublicaciÃ³n en Red | âš ï¸ Parcial | UI existe, flujo de aceptaciÃ³n bÃ¡sico |
| Coordinador asigna chofer+camiÃ³n | âœ… Funciona | Desde viajes activos |
| Chofer confirma viaje | âœ… Funciona | Desde web app mÃ³vil |
| Despachos multi-viaje | âš ï¸ Parcial | Funciona pero UI no refleja bien el progreso |
| ExpiraciÃ³n de despachos | âœ… Funciona | LÃ³gica de vencimiento implementada |

### FASE 2: TrÃ¡nsito a Origen
| Funcionalidad | Estado | Notas |
|---|---|---|
| Chofer inicia viaje | âœ… Funciona | BotÃ³n en web app |
| GPS Tracking en ruta | âš ï¸ Parcial | Hook existe, envÃ­o cada 30s, visualizaciÃ³n inconsistente |
| Chofer reporta arribo | âœ… Funciona | BotÃ³n en web app |
| EstimaciÃ³n de llegada (ETA) | âŒ Sin implementar | |

### FASE 3: Planta Origen
| Funcionalidad | Estado | Notas |
|---|---|---|
| CA escanea QR + ingreso | âœ… Funciona | Scanner + registro |
| Playa de espera | âœ… Funciona | Estado registrado |
| Supervisor llama a carga | âœ… Funciona | Desde supervisor-carga |
| Carga en progreso | âœ… Funciona | Estado tracked |
| Finalizar carga + foto remito | âœ… Funciona | Upload via API route (bypass RLS) |
| CA valida remito + egreso | âœ… Funciona | Preview + validaciÃ³n + egreso |
| Pesaje de carga | âŒ Sin implementar | |
| MÃºltiples documentos (carta porte, seguro) | âŒ Sin implementar | Solo remito |

### FASE 4: TrÃ¡nsito a Destino
| Funcionalidad | Estado | Notas |
|---|---|---|
| Chofer inicia viaje a destino | âœ… Funciona | BotÃ³n en web app |
| GPS Tracking | âš ï¸ Parcial | Mismo estado que Fase 2 |
| Chofer reporta arribo destino | âœ… Funciona | |

### FASE 5a: Planta Destino (CON Nodexia)
| Funcionalidad | Estado | Notas |
|---|---|---|
| CA ingreso destino | âŒ Sin implementar | CA actualmente solo maneja origen |
| Supervisor descarga | âŒ Sin implementar | supervisor-carga solo maneja carga |
| ValidaciÃ³n remito en destino | âŒ Sin implementar | |
| CA egreso destino | âŒ Sin implementar | |

### FASE 5b: Destino SIN Nodexia
| Funcionalidad | Estado | Notas |
|---|---|---|
| Chofer finaliza directo | âœ… Funciona | arribado_destino â†’ vacio |

### FASE 6: FinalizaciÃ³n
| Funcionalidad | Estado | Notas |
|---|---|---|
| Estado vacÃ­o registrado | âœ… Funciona | |
| TransiciÃ³n a viaje_completado | âŒ Falta | No se cierra automÃ¡ticamente |
| Cierre de despacho al completar viajes | âŒ Falta | |
| MÃ©tricas/reportes | âŒ Sin implementar | Timestamps parciales, sin KPIs |

---

## Temas Transversales Pendientes

| Tema | Prioridad | DescripciÃ³n |
|---|---|---|
| **RLS/Seguridad BD** | Alta (post-MVP) | API routes con service_role bypasean RLS. Doc: PENDIENTE-CRITICO-SEGURIDAD-API.md |
| **Notificaciones** | Media | Sin alertas push/email en cambios de estado |
| **Historial de viajes** | Media | Sin vista de viajes completados/histÃ³ricos |
| **Multi-viaje por despacho** | Media | Funciona parcial, UI necesita mejora |
| **Incidencias/Reclamos** | Baja (demo) | Tab existe en chofer sin funcionalidad |
| **DocumentaciÃ³n en viaje** | Media | Solo remito, faltan carta porte, seguro, etc. |
| **Tiempos y demoras** | Media | Timestamps parciales, sin cÃ¡lculo de KPIs |
| **Offline support** | Baja | Chofer sin conexiÃ³n no puede operar |
| **AuditorÃ­a/Logs** | Media (post-MVP) | Sin log de quiÃ©n hizo quÃ© y cuÃ¡ndo |

---

## Tablas Clave de la BD

| Tabla | PropÃ³sito |
|---|---|
| `despachos` | Pedidos de despacho creados por plantas |
| `viajes_despacho` | Viajes individuales de cada despacho |
| `choferes` | Registro de choferes con user_id vinculado |
| `camiones` | Flota de camiones por empresa |
| `empresas` | Empresas (plantas y transportistas) |
| `usuarios` | Usuarios del sistema |
| `usuarios_empresa` | RelaciÃ³n usuario-empresa-rol |
| `documentos_viaje_seguro` | Documentos (remitos, fotos) adjuntos a viajes |
| `ubicaciones_gps` | Registro de posiciones GPS |
| `estado_unidad_viaje` | Timestamps de cada transiciÃ³n de estado |

---

## API Routes Server-Side (bypass RLS)

| Ruta | PropÃ³sito |
|---|---|
| `/api/upload-remito` | Upload de foto remito (supervisor) |
| `/api/consultar-remito` | Consulta de remito por viaje_id (CA) |
| `/api/chofer/viajes` | Lista de viajes del chofer |
| `/api/viajes/[id]/estado-unidad` | Actualizar estado del viaje |

---

## Stack TecnolÃ³gico

- **Frontend**: Next.js 16 + React 19 + TypeScript + Tailwind v4
- **Backend**: Supabase (PostgreSQL + Auth + Storage + Realtime)
- **Maps**: Leaflet + OpenStreetMap
- **Hosting**: Vercel (deploy)
- **BD Dev**: Supabase proyecto separado
- **BD Prod**: Supabase proyecto de producciÃ³n
