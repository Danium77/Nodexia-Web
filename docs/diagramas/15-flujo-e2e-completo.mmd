sequenceDiagram
    actor CP as ðŸ­ Coord. Planta
    actor CT as ðŸš› Coord. Transporte
    actor CH as ðŸ§‘â€âœˆï¸ Chofer
    actor CA as ðŸš§ Control Acceso
    actor SC as ðŸ‘· Supervisor Carga
    participant SYS as âš™ï¸ Sistema
    
    Note over CP: FASE 0 - CreaciÃ³n
    CP->>SYS: Crear despacho + viajes
    Note over SYS: estado = pendiente
    
    Note over CP: FASE 1a - AsignaciÃ³n
    alt AsignaciÃ³n Directa
        CP->>CT: Asignar transporte
        Note over SYS: estado = transporte_asignado
    else Red Nodexia
        CP->>SYS: Publicar en Red
        CT->>SYS: Enviar oferta
        CP->>SYS: Aceptar oferta
        Note over SYS: estado = transporte_asignado
    end
    
    Note over CT: FASE 1b - Unidad
    CT->>SYS: Asignar chofer + camiÃ³n
    Note over SYS: estado = camion_asignado
    
    CH->>SYS: Confirmar viaje
    Note over SYS: estado = confirmado_chofer
    
    Note over CH: FASE 2 - TrÃ¡nsito a Origen
    CH->>SYS: Iniciar trÃ¡nsito + GPS
    Note over SYS: estado = en_transito_origen
    CH->>SYS: Arribo planta
    Note over SYS: estado = arribo_origen
    
    Note over CA: FASE 3 - Planta Origen
    CA->>SYS: Escanear QR + Confirmar ingreso
    Note over SYS: estado = ingresado_origen
    Note over SYS: auto = en_playa_origen
    
    SC->>SYS: Llamar a carga
    Note over SYS: estado = llamado_carga
    SC->>SYS: Iniciar carga
    Note over SYS: estado = cargando
    SC->>SYS: Finalizar carga + remito
    Note over SYS: estado = cargado
    
    Note over CA: FASE 4 - Egreso Origen
    CA->>SYS: Validar docs + Confirmar egreso
    Note over SYS: estado = egreso_origen
    
    Note over CH: FASE 5 - TrÃ¡nsito a Destino
    CH->>SYS: Iniciar trÃ¡nsito destino + GPS
    Note over SYS: estado = en_transito_destino
    CH->>SYS: Arribo destino
    Note over SYS: estado = arribo_destino
    
    Note over CA: FASE 6 - Planta Destino
    CA->>SYS: Confirmar ingreso destino
    Note over SYS: estado = ingresado_destino
    SC->>SYS: Llamar descarga + Descargar
    Note over SYS: estado = descargado
    
    Note over CA: FASE 7 - Egreso Destino
    CA->>SYS: Confirmar egreso destino
    Note over SYS: estado = egreso_destino
    Note over SYS: auto = vacio
    
    Note over SYS: FASE 8 - Cierre
    SYS->>SYS: Auto-completar viaje
    Note over SYS: estado = viaje_completado
    SYS->>SYS: Si todos completos
    Note over SYS: despacho = completado
