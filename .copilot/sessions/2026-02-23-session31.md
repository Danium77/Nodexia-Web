# Sesión 31 — 23-Feb-2026

## 5 Production Bug Fixes (Pre-Demo Testing)

### Contexto
PO testeó producción (nodexiaweb.com) y reportó 5 bugs con screenshots.
Demo en 5 días (28-Feb-2026).

### Bugs Corregidos

| # | Bug | Root Cause | Fix |
|---|-----|-----------|-----|
| 1 | White stripe bottom admin pages | `body bg: var(--background)` = white | `body bg: #0a0e1a` + `min-h-screen` |
| 2 | Duplicate search filter cargas-en-red | Search bar rendered both outside and inside tabs | Removed outer duplicate (45 lines) |
| 3 | Header/Sidebar names wrong | Header showed user name, sidebar showed email | Header → `empresaNombre`, Sidebar → `nombre_completo` |
| 4 | Camion insert error (id_transporte NULL) | PROD DB has legacy `id_transporte NOT NULL` | Added `id_transporte: empresaId` to insert |
| 5 | Infinite loading on page transitions | No timeout fallback on `routeChangeComplete` | 8-second safety timeout |

### Archivos Modificados (8)
- `styles/globals.css`
- `pages/admin/empresas.tsx`
- `pages/transporte/cargas-en-red.tsx`
- `pages/_app.tsx`
- `components/layout/AdminLayout.tsx`
- `components/layout/Sidebar.tsx`
- `lib/contexts/UserRoleContext.tsx`
- `components/Transporte/UnidadesFlotaUnificado.tsx`

### Nuevas Decisiones
- DEC-032: Body bg hardcoded `#0a0e1a` (dark theme everywhere)
- DEC-033: id_transporte pragmatic fix (both empresa_id + id_transporte) until PROD migration

### Commit
`22564f8` — 8 files changed, 57 insertions, 65 deletions

### Pendiente
- Verificar deploy PROD
- Testing continuado
- Evaluación arquitectura (diferido)
- Datos demo 28-Feb
- Migración PROD: DROP NOT NULL on id_transporte
